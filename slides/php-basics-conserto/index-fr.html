<!doctype html>
<html lang="fr">

<head>
<meta charset="utf-8">

<title>PHP Basics</title>

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

<link rel="stylesheet" href="css/reveal.css">
<link rel="stylesheet" href="css/theme/black.css" id="theme">

<!-- Code syntax highlighting -->
<link rel="stylesheet" href="lib/css/zenburn.css">
<link rel="stylesheet" href="css/styles.css">

<!-- Printing and PDF exports -->
<script>
var link  = document.createElement( 'link' );
link.rel  = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->
</head>

<body>

<div class="reveal">

<div class="slides">
<section>
	<section>
		<h1>PHP : les bases</h1>
		<p>Maxence POUTORD</p>
	</section>
</section>

<section>
	<h2>Objectifs</h2>
	<ul>
		<li>Bases de PHP</li>
		<li>Utiliser un moteur de templates</li>
		<li>Communiquer avec une base de données MySQL</li>
		<li>Faire une application web</li>
	</ul>
</section>
<section>
	<section>
		<h2>PHP: Hypertext Prepocessor</h2>
		<ul>
			<li>20 ans !</li>
			<li>6e langage dans le monde (TIOBE septembre 2015)</li>
			<li>80% des serveurs web</li>
			<li>Types de sites :</li>
			<ul>
				<li>Petits : Conserto...</li>
				<li>Moyens : Voyage SNCF, Maison blanche...</li>
				<li>Gros   : Facebook...</li>
			</ul>
		</ul>
		<aside class="notes"></aside>
	</section>
	<section>
		<h2>Client/Serveur</h2>
		<p><img data-src="img/client-server.png" style="border:10px solid #FFFFFF; box-shadow: 1px 1px 12px #555;"></p>
		<ul>
				<li>Client = navigateur. <br>Envoie requête</li>
				<li>Serveur = Serveur web. <br>Retourne une réponse</li>
		</ul>
	</section>
	<section>
		<h2>Installation</h2>
		<ul>
			<li>Linux : sudo apt-get install php5-common libapache2-mod-php5 php5-cli</li>
			<li>OSX : à peu près comme sur Linux</li>
			<li>Windows : <b>éviter WAMP</b>! Utilisez <a href="https://box.scotch.io/">vagrant box</a> à la place (ou docker)</li>
		</ul>
		<aside class="notes">
			Suggest this box : <a href="https://box.scotch.io">https://box.scotch.io</a>
		</aside>
	</section>
	<section>
		<h2>RTFM</h2>
		<img data-src="img/rtfm.jpg" style="border:none;">
		<p><a href="http://www.php.net">http://www.php.net</a></p>
	</section>
</section>
<section>
	<section>
		<h2>Bases de PHP</h2>
	</section>
	<section>
		<h2>Exemple de fichier</h2>
		<p>index.php</p>
<pre><code data-trim contenteditable>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;?php echo "Hello World !"; ?&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p class="fragment"></b>Note :</b> chaque ligne se termine par un <b>;</b></p>
	</section>
	<section>
		<h2>Commentaires</h2>
<pre><code data-trim contenteditable>
//A single line comment
/*
A multi-line
comment
 */
# Another one line comment (à éviter)
</code></pre>
	</section>
	<section>
		<h2>Types (1/2)</h2>
<pre><code data-trim contenteditable class="hljs">
$nothing   = null;
$firstName = "John";             //with single quote
$lastName  = 'WAYNE';            //with double quote
$name      = "Bruce ".$lastName; //concatenation
$name     .= " aka Batman";      //concatenation
$age       = 51;
$young     = false;
$pi        = 3.14;
$object    = new SomeObject();

echo "Hello $name !";
echo 'Hello ' . $firstName . $lastName .' !';
</code></pre>
</section>
<section>
		<h2>Types (2/2)</h2>
<pre><code data-trim contenteditable class="hljs">
$hobbits = array("Frodo", "Bilbo", "Sam");
$lands[]  = "Shire";   //$lands[0] == "Shire";
$lands[]  = "Rohan";   //$lands[1] == "Rohan";
$lands[1] = "Gondor";  //$lands[1] == "Gondor";
echo "I live in $lands[1]";
</code></pre><pre><code data-trim contenteditable class="hljs fragment">

$person['name'] = "Frodo";
$person['land'] = "Shire";

</code></pre>
<pre><code data-trim contenteditable class="hljs fragment">
//Multidimensionnal array
$persons[0]['name'] = "Frodo";
$persons[0]['land'] = "Shire";
$persons[1]['name'] = "Gandalf";
$persons[1]['land'] = "Gondor";

$array[someIndex][someOtherIndex][someOtherIndex]...[] = $whatever;
</code></pre>
	</section>
	<section>
		<h2>Opérateurs de comparaison</h2>
<pre><code data-trim contenteditable>
$a = 42;
$b = 51;
$c = $b;

var_dump($a <= $b);    //true
var_dump($b == $c);    //true
var_dump($b == "51");  //true
var_dump($b === "51"); //false
</code></pre>
	</section>
	<section>
		<h2>Opérateurs logiques</h2>
		<ul>
			<li>$a and $b</li>
			<li>$a or $b</li>
			<li>!a</li>
			<li>$a && $b (like <b>and</b> operator)</li>
			<li>$a || $b (like <b>or</b> operator)</li>
		</ul>
	</section>
	<section>
		<h2>Conditions</h2>
<pre><code data-trim contenteditable class="fragment">
if ($language == "fr") {
    echo "Bienvenue";
} elseif ($language == "en") {
    echo "Hello";
} else {
    echo "Ciao";
}
</code><code data-trim contenteditable class="fragment">
switch($language) {
    case "fr": echo "Bonjour";
        Break;
    case "en": echo "Hello";
        Break;
    case "it": echo "Ciao";
        Break;
    default: echo "Bonjour";
}
</code></pre>
	</section>
	<section>
		<h2>Loops</h2>
<pre><code data-trim contenteditable class="fragment">
for ($i = 1; $i <= 10; $i++) {
    echo $i;
}
//1 2 3 4 5 6 7 8 9 10
</code><code data-trim contenteditable class="fragment">
$i = 0;
while (i <= 10) {
    echo $i;
    $i++;
}
//0 1 2 3 4 5 6 7 8 9 10
</code><code data-trim contenteditable class="fragment">
$fruits = array("banana", "apple", "cherry");
foreach ($fruits as $aFruit) {
    echo $fruit;
}
//banana apple cherry
</code></pre>
	</section>
	<section>
		<h2>Fonctions (1/2)</h2>
<pre><code data-trim contenteditable>
$phrase = "Java is great !";
echo str_replace("Java", "PHP", $phrase); //"PHP is great !"
echo "We are ".date('d m Y');
</code></pre>
A lot of String functions : <a href="http://php.net/manual/fr/ref.strings.php">http://php.net/manual/fr/ref.strings.php</a><br>
Same for date functions : <a href="http://php.net/manual/fr/ref.datetime.php">http://php.net/manual/fr/ref.datetime.php</a>
	</section>
	<section>
		<h2>Fonctions (2/2)</h2>
<pre><code data-trim contenteditable>
function sayHello($name) {
    echo "Hello $name !";
}
sayHello("World"); //Hello World !
</code><code data-trim contenteditable class="fragment">
function cube($var) {
    return $var * $var * $var;
}
$myVar = cube(4); //$myVar == 64
</code></pre>
	</section>
	<section>
		<h2>Erreurs</h2>
		<table>
			<thead>
				<tr>
					<th>Constante</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>E_ERROR</td>
					<td>Fatal run-time errors. Execution du script arrêtée</td>
				</tr>
				<tr>
					<td>E_WARNING</td>
					<td>Non-fatal run-time errors. Le script continue de s'exécuter</td>
				</tr>
				<tr>
					<td>E_NOTICE</td>
					<td>Run-time notices. Le script trouve quelque chose qui pourrait s'apparenter à une erreur.</td>
				</tr>
			</tbody>
		</table>
	</section>
	<section>
		<h2>Pas d'erreurs en environnement de production !</h2>
		<p><img data-src="img/errors.PNG" style="border:10px solid #FFFFFF; box-shadow: 1px 1px 12px #555;"></p>
	</section>
	<section>
		<h2>Gérer les erreurs</h2>
<pre><code data-trim contenteditable>
try {
    echo 1/0;
} catch (Exception $e) {
    echo "Can't divide by zero";
    echo $e;
}
</code></pre>
	</section>
	<section>
		<h2>Mail</h2>
<pre><code data-trim contenteditable>
$headers  = "From: Barack OBAMA &lt;barack.obama@whitehouse.gov&gt;";
$headers .= 'Content-type: text/html; charset=utf-8';

if (mail('kim-jong-un@korea-dpr.com', 'Hi guy', 'Hey, I\'m ready to fight', $headers)) {
  echo "OK. Nulclear war is ready!";
} else {
  echo "KO";
}
</code></pre>
	</section>
	<section>
		<h2>Travailler avec des fichiers</h2>
<pre><code data-trim contenteditable>
$headers  = "From: My name &lt;contact@me.fr&gt;";
$headers .= 'Content-type: text/html; charset=utf-8';

$myFile = fopen('mailingList.txt', 'r');
while (($line = fgets($myFile)) !== false) {
    mail($line, 'Hello', 'Visit my new website !', $headers)
}
fclose($myFile);
</code></pre>
		<table class="fragment">
			<thead>
				<tr>
					<th>Mode</th>
					<th>Details</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>r</td>
					<td>Lecture</td>
				</tr>
				<tr>
					<td>r+</td>
					<td>Lecture/Ecriture</td>
				</tr>
				<tr>
					<td>a</td>
					<td>Lecture. Création du fichier s'il n'existe pas.</td>
				</tr>
				<tr>
					<td>a+</td>
					<td>Read/Ecriture. Création du fichier s'il n'existe pas.</td>
				</tr>
			</tbody>
		</table>
	</section>
</section>
<section>
	<section>
		<h2>Inclusion de fichiers</h2>
	</section>
	<section>
		<h2>Pourquoi ?</h2>
		<ul>
			<li class="fragment">Eviter les erreurs de copié/collé</li>
			<li class="fragment">Améliorer la lecture du code...</li>
			<li class="fragment">...et sa maintenabilité</li>
		</ul>
		<p></p>
		<h2 class="fragment">Quoi ?</h2>
		<ul>
			<li class="fragment">éléments HTML</li>
			<li class="fragment">fonctions PHP, classes...</li>
		</ul>
	</section>
	<section>
		<h2>Exemple (1/2)</h2>
		<p><img data-src="img/conserto-1.png" style="border:10px solid #FFFFFF;"></p>
	</section>
	<section>
		<h2>Exemple (2/2)</h2>
		<p><img data-src="img/conserto-2.png" style="border:10px solid #FFFFFF;"></p>
	</section>
	<section>
		<h2>Inclusion de fichiers</h2>
		<p>4 façons :</p>
		<ul>
			<li class="fragment">include 'myFile.php' : va inclure myFile.php</li>
			<li class="fragment">require 'myFile.php' : identique à include, mais produit une erreur en cas d'échec</li>
			<li class="fragment">include_once/require_once 'myFile.php' : identique à include/require, mais vérifie si le fichier n'a pas déjà été inclu</li>
		</ul>
<pre class="fragment"><code data-trim contenteditable>
//vars.php
$film = "Batman";
//index.php
include 'vars.php';
echo "I'm watching $film"; //I'm watching Batman
</code></pre>
	</section>
	<section>
		<h2>Twig</h2>
		<p>en quelques mots :</p>
		<ul>
			<li>Séparation PHP/HTML</li>
			<li>Syntaxe plus lisible</li>
			<li>Ajoute de la sécurité</li>
			<li>Documenté (<a href="http://twig.sensiolabs.org">http://twig.sensiolabs.org</a>)</li>
		</ul>
<pre class="fragment"><code data-trim contenteditable>
//Before
<p>&lt;?php echo $var ?&gt;</p>
//After
<p>{{ var }}</p>
</code></pre>
	</section>
	<section>
		<h2>Syntaxe TWIG (1/2) : Avant</h2>
		<pre class="fragment"><code data-trim contenteditable>
&lt;ul&gt;
    &lt;?php
    if (count($users) &gt; 0) {
        foreach ($users as $aUser) {
            echo "&lt;li&gt;".$aUser['name']." live in ".$aUser['city']."&lt;/li&gt;";
        }
    } else {
        echo "&lt;li&gt;no user found&lt;/li&gt;";
    }
    ?&gt;
&lt;/ul&gt;
			</code></pre>
	</section>
	<section>
		<h2>Syntaxe TWIG (2/2) : Après</h2>
		<pre class="fragment"><code data-trim contenteditable>
<ul>
    {% for aUser in users %}
        <li>{{ aUser.name }} live in {{ aUser.name }}</li>
    {% else %}
        <li><em>no user found</em></li>
    {% endfor %}
</ul>
			</code></pre>
	</section>
	<section>
		<h2>Filtres TWIG</h2>
		<pre class="fragment"><code data-trim contenteditable>
{{ "now"|date("m/d/Y") }} // 2/11/2015

{{ 'abcd...'|reverse }} //...dcba

{{ '12345'[1:2] }} //23

{{ 101.51|round }} //102
		</code></pre>
	</section>
	<section>
		<h2>PHP/HTML separation&new workflow</h2>
		<p class="fragment"><img data-src="img/twig-workflow.PNG" style="border:10px solid #FFFFFF;"></p>
	</section>
	<section>
		<h2>Utilisation de TWIG</h2>
		<pre class="fragment"><code data-trim contenteditable>
//kernel.php
include_once('../Twig/lib/Twig/Autoloader.php');
Twig_Autoloader::register();
$loader = new Twig_Loader_Filesystem(__DIR__."/../views"); // view folder
$twig = new Twig_Environment($loader, array(
		'cache' => false
));

//script.php
include_once('kernel.php');
$template = $twig->loadTemplate('welcome.html.twig');
echo $template->render(array(
	'user'     => $user,
	'whatever' => $whatever
));
		</code></pre>
	</section>
	<section>
		<h2>Séparation du code/<h2>
		<pre class="fragment"><code data-trim contenteditable>
//layout.html.twig
&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;...&lt;/head&gt;
	&lt;body&gt;
		{% block body %}{% endblock %}
	&lt;/body&gt;
&lt;/html&gt;

//feature.html.twig
{% extends "layout.html.twig" %}
{% block body %}
{% if user %}
		<p>Welcome {{ user }}!</p>
{% endif %}
{% endblock %}
		</code></pre>
	</section>
	<section>
		<h2>Commençons</h2>
		<ul>
			<li>Documentation : <a href="http://twig.sensiolabs.org">http://twig.sensiolabs.org</a></li>
			<li>Installation : <a href="https://github.com/twigphp/Twig">https://github.com/twigphp/Twig</a></li>
		</ul>
	</section>
</section>
<section>
	<section>
		<h2>Envoyer des données du client au serveur</h2>
	</section>
	<section>
		<h2>Récupération par formulaire (méthode POST)</h2>
		<pre><code data-trim contenteditable class="fragment">
<form action="script.php" method="POST">
  <input type="hidden" name="role" value="user">
  <input type="text" name="name">
  <input type="submit" value="submit">
</form>
			</code><code data-trim contenteditable class="fragment">
echo $_POST['role'];
echo $_POST['name'];
			</code></pre>
	</section>
	<section>
		<h2>Récupération à partir d'URL (méthode GET)</h2>
		<pre class="fragment"><code data-trim contenteditable>
http://www.mywonderfulapp.com/script.php?firstname=john&lastname=doe&age=42
echo $_GET['firstname'], " ", $_GET['lastname'], $_GET['age']; //john doe 42
			</code><code data-trim contenteditable class="fragment">
<form action="http://www.google.com/" method="get">
  <input type="text" name="q">
  <input type="submit" value="search on Google">
</form>
			</code></pre>
		<form action="http://www.google.com/" class="fragment" method="get">
		  <p>Exemple :</p>
			<input type="text" name="q">
			<input type="submit" value="search on Google">
		</form>
	</section>
	<section>
		<h2>Never trust user input : SQL Injection</h2>
		<p class="fragment"><img data-src="img/sql-injection.jpg" style="border:10px solid #FFFFFF; max-width: 66%;"></p>
	</section>
	<section>
		<h2>Never trust user input : $_GET & include</h2>
		<pre class="fragment" style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0.3);"><code data-trim contenteditable>
include "include/".$_GET["page"].".php";
</code><code data-trim contenteditable class="fragment">
//http://www.vulnerable_host.com/preview.php?page=../../../../etc/passwd%00
</code></pre>
		<p class="fragment"><img data-src="img/barrier.jpg" style="border:none; max-width: 30%;"></p>
		<aside class="notes">
			http://www.vulnerable_host.com/preview.php?page=../../../../etc/passwd%00
		</aside>
	</section>
	<section>
		<h2>Never trust user input : XSS</h2>
		<p><img data-src="img/xss-fail.PNG"></p>
		<pre style="box-shadow: 0px 0px 0px rgba(0, 0, 0, 0.3);"><code data-trim contenteditable class="fragment fade-out">
echo $_GET["message"];
		</code><code data-trim contenteditable class="fragment">
echo htmlspecialchars($_GET["message"]);
		</code></pre>
		<aside class="notes">
			echo $_GET["message"]; //print message. Browser execute script
			echo htmlspecialchars($_GET["message"]); //print message. Browser can't execute script (Convert special characters to HTML entities)
		</aside>
	</section>
</section>
<section>
	<section>
		<h2>Manipuler des données à partir d'une base MySQL</h2>
	</section>
	<section>
		<h2>PHPMyAdmin</h2>
		<ul>
			<li>Logiciel web pour gérer l'administration de MySQL</li>
			<li>Gère les tables, données, utilisateurs</li>
			<li>...Libre !</li>
			<li><a href="http://demo.phpmyadmin.net/master-config/">Demo</a></li>
		</ul>
	</section>
	<section>
		<h2>PDO (1/4) : en quelques mots</h2>
		<p>PDO = PHP Data Object</p>
		<p>Sécurise les requêtes</p>
		<img class="fragment" data-src="img/pdo.PNG" style="border:10px solid #FFFFFF;">
	</section>
	<section>
		<h2>PDO (2/4) : Connection&Récupération de données</h2>
		<pre class="fragment"><code data-trim contenteditable>
try {
    $bdd = new PDO('mysql:host=localhost;dbname=test;charset=utf8',
                  'root', 'root');

    $reponse = $bdd->query('SELECT * FROM beers');
    $data = $reponse->fetch();

} catch(Exception $e) {
    die("Cannot connect to database server");
}
			</code></pre>
	<p class="fragment">Maintenant $data est un tableau de bieres !</p>
	</section>
	<section>
		<h2>PDO (3/4) : Requêtes préparées</h2>
		<p class="fragment">Evite les Injection SQL</p>
		<pre class="fragment"><code data-trim contenteditable>
$request = $bdd->prepare("INSERT INTO beers (name, description)
                       VALUES (:name, :description)");
$request->bindParam(':name', $name);
$request->bindParam(':description', $description);

$name = "Mélusine Bière de Noël";
$description = "Merry christmas !";
$request->execute();

$name = "Kronembourg";
$description = "You get what you pay for...";
$request->execute();
			</code></pre>
	</section>
	<section>
		<h2>PDO (4/4) : autres requêtes CRUD</h2>
		<pre class="fragment"><code data-trim contenteditable>
//UPDATE
$sql = 'UPDATE beers set name=:name where id=:id';
$request = $bdd->prepare($sql);
$request->execute(array(
    ':name' => 'Grimbergen',
    ':id' => 1
));

//DELETE
$sql = 'DELETE from beers where id=:id';
$request = $bdd->prepare($sql);
$request->execute(array(':id' => 1));
		</code></pre>
	</section>
</section>
<section>
	<section>
		<h2>Fin</h2>
		<h2 class="fragment">...en fait non !</h2>
	</section>
	<section>
		<h2>Comment s'améliorer ? (1/2)</h2>
		<p><b>Ne pas recopier du code bêtement</b></p>
		<img data-src="img/copypaste.jpg" style="border:0px solid #FFFFFF; box-shadow: 1px 1px 12px #555;">
	</section>
	<section>
		<h2>Comment s'améliorer ? (2/2)</h2>
		<img data-src="img/better-coder.png" style="max-width: 30%;">
	</section>
	<section>
		<h2>Normes de codage</h2>
		<p>Essayez de respecter les recommandations PSR</p>
		<a href="http://www.php-fig.org/">http://www.php-fig.org</a>
	</section>
	<section>
		<h2>Sécurité</h2>
		<p><img data-src="img/mouse-mission-impossible.jpg" style="max-width: 60%; box-shadow: 1px 1px 12px #555;"></p>
		<a href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project">OWASP Top 10</a>
	</section>
	<section>
		<h2>Performances avec Blackfire</h2>
		<iframe width="536" height="332" src="https://www.youtube.com/embed/AygjcT_lsQI" frameborder="0" allowfullscreen></iframe>
		<p><a href="https://blackfire.io/">Blackfire.io</a></p>
	</section>
	<section>
		<h2>Utilisez un framework</h2>
		<p>Pourquoi ? Améliore...</p>
		<ul>
			<li>Sécurité</li>
			<li>Vélocité</li>
			<li>Organisation du code</li>
			<li>Qualité du code (?)</li>
		</ul>
		<p>Je recommande Symfony2 (plus populaire en France)</p>
		<p><a href="http://www.maxpou.fr/utilisez-un-framework-php/">Voir plus</a></p>
	</section>
	<section>
		<h2>Il n'y a pas de fin ;-)</h2>
		<p><img data-src="img/Life-Long-Learning-Logo.jpg" style="border:10px solid #FFFFFF; box-shadow: 1px 1px 12px #555;"></p>
		<p>Ne vous arrêtez pas là : <a href="https://www.codecademy.com/tracks/php">https://www.codecademy.com/tracks/php</a></p>
	</section>
</section>
<section>
	<h2>Merci</h2>
	<h3>Questions ?</h3>
</section>

</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

// Full list of configuration options available at:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
	controls: true,
	progress: true,
	slideNumber: true,
	history: true,
	center: true,

	transition: 'convex', // none/fade/slide/convex/concave/zoom

// Optional reveal.js plugins
dependencies: [
	{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
	{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
	{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
	{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
	{ src: 'plugin/zoom-js/zoom.js', async: true },
	{ src: 'plugin/notes/notes.js', async: true }
]
});

</script>


</body>
</html>
